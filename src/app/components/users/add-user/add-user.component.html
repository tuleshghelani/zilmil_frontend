<div class="user-form-container">
  <div class="form-card card">
    <div class="form-header">
      <h2>
        <i class="fas fa-user-edit"></i>
        {{ isEditing ? 'Update User' : 'Add New User' }}
      </h2>
      <button class="btn btn-sm btn-secondary" (click)="onCancel()" title="Cancel">
        <i class="fas fa-times"></i> Cancel
      </button>
    </div>

    <app-loader [show]="isLoadingUser"></app-loader>

    <div *ngIf="!isLoadingUser" class="form-content">
      <div *ngIf="isEditing && user" class="user-info">
        <div class="info-card">
          <div class="info-header">
            <i class="fas fa-user-circle"></i>
            <h3>User Information</h3>
          </div>
          <div class="info-grid">
            <!-- <div class="info-item">
              <label><i class="fas fa-id-card"></i> ID</label>
              <span>{{ user.id }}</span>
            </div> -->
            <div class="info-item">
              <label><i class="fas fa-user"></i> Name</label>
              <span>{{ user.firstName }} {{ user.lastName }}</span>
            </div>
            <div class="info-item">
              <label><i class="fas fa-envelope"></i> Email</label>
              <span>{{ user.email }}</span>
            </div>
            <div class="info-item">
              <label><i class="fas fa-user-tag"></i> Roles</label>
              <span>
                <span class="role-badge" *ngFor="let role of user.roles">
                  {{ role }}
                </span>
              </span>
            </div>
            <div class="info-item">
              <label><i class="fas fa-building"></i> Client</label>
              <span>{{ user.clientName }}</span>
            </div>
            <!-- <div class="info-item">
              <label><i class="fas fa-shield-alt"></i> Type</label>
              <span *ngIf="user.isSystem" class="system-badge">
                <i class="fas fa-shield-alt"></i> System User
              </span>
              <span *ngIf="!user.isSystem" class="user-badge">
                Regular User
              </span>
            </div> -->
          </div>
        </div>
      </div>

      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
        <div class="form-section">
          <h3><i class="fas fa-key"></i> Password Settings</h3>
          
          <div class="form-group">
            <label for="password">
              <i class="fas fa-lock"></i> New Password <span class="required">*</span>
            </label>
            <div class="password-input-wrapper">
              <input 
                [type]="showPassword ? 'text' : 'password'"
                id="password" 
                formControlName="password" 
                class="form-control"
                [class.is-invalid]="userForm.get('password')?.invalid && (userForm.get('password')?.touched || isSubmitted)"
                placeholder="Enter new password"
                (input)="onPasswordChange()"
                autocomplete="new-password"
              >
              <button 
                type="button" 
                class="password-toggle"
                (click)="togglePasswordVisibility()"
                title="{{ showPassword ? 'Hide' : 'Show' }} password"
              >
                <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
              </button>
            </div>
            <div class="password-strength-indicator">
              <div class="strength-bar" [ngClass]="getPasswordStrengthClass()">
                <div class="strength-fill"></div>
              </div>
              <span class="strength-text" *ngIf="userForm.get('password')?.value">
                Password Strength: <strong>{{ getPasswordStrengthText() }}</strong>
              </span>
            </div>
            <div class="invalid-feedback" *ngIf="userForm.get('password')?.errors && (userForm.get('password')?.touched || isSubmitted)">
              {{ getFieldError('password') }}
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i>
              Password must be at least 3 characters long
            </div>
          </div>

          <div class="form-group">
            <label for="confirmPassword">
              <i class="fas fa-lock"></i> Confirm Password <span class="required">*</span>
            </label>
            <input 
              [type]="showPassword ? 'text' : 'password'"
              id="confirmPassword" 
              formControlName="confirmPassword" 
              class="form-control"
              [class.is-invalid]="(userForm.get('confirmPassword')?.invalid || userForm.errors?.['passwordMismatch']) && (userForm.get('confirmPassword')?.touched || isSubmitted)"
              placeholder="Confirm new password"
              autocomplete="new-password"
            >
            <div class="invalid-feedback" *ngIf="userForm.get('confirmPassword')?.errors && (userForm.get('confirmPassword')?.touched || isSubmitted)">
              {{ getFieldError('confirmPassword') }}
            </div>
            <div class="invalid-feedback" *ngIf="userForm.errors?.['passwordMismatch'] && (userForm.get('confirmPassword')?.touched || isSubmitted)">
              {{ getFormError() }}
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-toggle-on"></i> Status Settings</h3>
          
          <div class="form-group">
            <label for="status">
              <i class="fas fa-circle"></i> Status <span class="required">*</span>
            </label>
            <select 
              id="status" 
              formControlName="status" 
              class="form-control"
              [class.is-invalid]="userForm.get('status')?.invalid && (userForm.get('status')?.touched || isSubmitted)"
            >
              <option value="A">Active</option>
              <option value="I">Inactive</option>
            </select>
            <div class="invalid-feedback" *ngIf="userForm.get('status')?.errors && (userForm.get('status')?.touched || isSubmitted)">
              Status is required
            </div>
            <div class="form-hint">
              <i class="fas fa-info-circle"></i>
              Active users can log in, inactive users cannot
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-sm btn-secondary" 
            (click)="onCancel()"
          >
            <i class="fas fa-times"></i> Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-sm btn-primary"
            [disabled]="userForm.invalid || isLoading || (isEditing && user?.isSystem)"
            *ngIf="!isEditing || !user?.isSystem"
          >
            <i class="fas" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-save'"></i>
            {{ isLoading ? 'Updating...' : 'Update User' }}
          </button>
          <div class="system-user-notice" *ngIf="isEditing && user?.isSystem">
            <i class="fas fa-info-circle"></i>
            System users cannot be modified
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

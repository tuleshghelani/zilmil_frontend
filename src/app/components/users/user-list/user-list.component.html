<div class="user-container">
  <div class="search-section card">
    <h2><i class="fas fa-users"></i> Search Users</h2>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="search-controls">
        <div class="form-group">
          <input 
            type="text" 
            formControlName="search" 
            class="form-control" 
            placeholder="Search by name or email..."
            (keyup.enter)="onSearch()"
          >
        </div>
        <div class="form-group status-filter">
          <select formControlName="status" class="form-control">
            <option value="A">Active</option>
            <option value="I">Inactive</option>
            <option value="all">All</option>
          </select>
        </div>
        <div class="button-group">
          <button type="submit" class="search-btn btn btn-sm btn-primary">
            <i class="fas fa-search"></i> Search
          </button>
          <button type="button" class="search-btn btn btn-sm btn-secondary" (click)="resetForm()">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="users-list card">
    <div class="card-header">
      <h2><i class="fas fa-users"></i> Users</h2>
      <div class="results-info" *ngIf="totalElements > 0">
        Showing {{ startIndex + 1 }} - {{ endIndex }} of {{ totalElements }} users
      </div>
    </div>
    
    <div class="table-wrapper">
      <div class="table-container">
        <app-loader [show]="isLoading"></app-loader>
        
        <div class="table-responsive" [class.loading]="isLoading">
          <table class="table">
            <thead>
              <tr>
                <th (click)="onSort('id')" class="sortable">
                  Number <i class="fas" [ngClass]="getSortIcon('id')"></i>
                </th>
                <th (click)="onSort('firstName')" class="sortable">
                  Name <i class="fas" [ngClass]="getSortIcon('firstName')"></i>
                </th>
                <th>Email</th>
                <th>Roles</th>
                <th>Client</th>
                <th (click)="onSort('status')" class="sortable">
                  Status <i class="fas" [ngClass]="getSortIcon('status')"></i>
                </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users; let index = index" class="user-row">
                <td>{{ startIndex + index + 1 }}</td>
                <td>
                  <div class="user-name">
                    <strong>{{ user.firstName }} {{ user.lastName }}</strong>
                  </div>
                </td>
                <td>
                  <div class="user-email">
                    <i class="fas fa-envelope"></i> {{ user.email }}
                  </div>
                </td>
                <td>
                  <div class="roles">
                    <span class="role-badge" *ngFor="let role of user.roles">
                      {{ role }}
                    </span>
                  </div>
                </td>
                <td>
                  <div class="client-info">
                    {{ user.clientName }}
                  </div>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusBadgeClass(user.status)">
                    <i class="fas" [ngClass]="user.status === 'A' ? 'fa-check-circle' : 'fa-times-circle'"></i>
                    {{ getStatusText(user.status) }}
                  </span>
                </td>
                <td class="actions">
                  <button 
                    class="btn-icon edit" 
                    [routerLink]="['/users/edit', user.id]"
                    title="Edit User"
                    *ngIf="!user.isSystem"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <span class="no-action" *ngIf="user.isSystem" title="System users cannot be edited">
                    <i class="fas fa-lock"></i>
                  </span>
                </td>
              </tr>
              <tr *ngIf="!isLoading && (!users || users.length === 0)">
                <td colspan="8" class="text-center no-data">
                  <i class="fas fa-inbox"></i>
                  <p>No users found</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <app-pagination
      *ngIf="totalPages > 0"
      [currentPage]="currentPage"
      [pageSize]="pageSize"
      [totalElements]="totalElements"
      [pageSizeOptions]="pageSizeOptions"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
    ></app-pagination>
  </div>
</div>
